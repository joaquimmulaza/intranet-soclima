<?php

namespace App\Http\Controllers;

use App\Models\DocumentRequest;
use Illuminate\Http\Request;

class AdminDocumentRequestController extends Controller
{
    public function index()
    {
        // Obtém todas as solicitações, paginadas
        $requests = DocumentRequest::latest()->paginate(10);
        return view('admin.document-requests.index', compact('requests'));
    }

    public function uploadDocument(Request $request, $id)
    {
        $documentRequest = DocumentRequest::findOrFail($id);

        // Upload do arquivo
        if ($request->hasFile('documento')) {
            $path = $request->file('documento')->store('documents');
            $documentRequest->update(['documento_path' => $path, 'status' => 'documento enviado']);
        }

        return back()->with('success', 'Documento enviado com sucesso.');
    }

    public function markAsComplete($id)
    {
        $documentRequest = DocumentRequest::findOrFail($id);

        // Atualiza o status
        $documentRequest->update(['status' => 'concluído']);

        return back()->with('success', 'Solicitação marcada como concluída.');
    }
}
